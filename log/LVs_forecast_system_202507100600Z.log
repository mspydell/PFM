initializing model and making the info.pkl file.
The model information in:
/home/mspydell/models/PFM_root/PFM/sdpm_py_util/pfm_input_v2p0.py
is turned into a .pkl file of model info.
The model_info dictionary is saved to /scratch/matt/PFM_Simulations_v2/forecast_info.pkl
This file dictates how the model is run, where files are saved, etc.

------------------------------------------------------------
                        Model Set Up                        
------------------------------------------------------------
forecast                                                    
from           : 2025-07-10 12:00                           
to             : 2025-07-15 12:00                           
in a           : 5.0 day chunk                              
atm model      : ecmwf                                      
ocean_model    : hycom_new                                  
running levels : LV1, LV2, LV3, LV4                         

===========================
!!!starting the forecast with subprocess!!!
current time is:  2025-07-10 17:00:03.216098
===========================
The model information in:
/home/mspydell/models/PFM_root/PFM/sdpm_py_util/pfm_input_v2p0.py
is turned into a .pkl file of model info.
The model_info dictionary is saved to /scratch/matt/PFM_Simulations_v2/forecast_info.pkl
This file dictates how the model is run, where files are saved, etc.

------------------------------------------------------------
                        Model Set Up                        
------------------------------------------------------------
forecast                                                    
from           : 2025-07-10 12:00                           
to             : 2025-07-15 12:00                           
in a           : 5.0 day chunk                              
atm model      : ecmwf                                      
ocean_model    : hycom_new                                  
running levels : LV1, LV2, LV3, LV4                         
Starting the loop over levels to run!

--------------------------
starting LV1
starting LV1 forecast with subprocess...
We are starting clean.
Removing files from directories...
...done.
202507101200

Going to do a PFM forecast from
2025-07-10 12:00:00
to
2025-07-15 12:00:00
getting the hycom forecast time...
this will clean, download new hycom files, then find the forecast date covering the PFM times.
we currently have hycom forecasts starting from:
['2025-07-08', '2025-07-09']
checking to see if we are missing any files...
we are missing 57 files from these forecasts.
attempting to get these files ...
getting <=10 hycom files... done
getting <=10 hycom files... done
getting <=10 hycom files... done
getting <=10 hycom files... done
getting <=10 hycom files... done
getting <=10 hycom files... done
...done
we are now missing 57 files from these forecasts.

attempting to get a new hycom forecast...
no need to get a new forecast. We are up to date.
now how many total files are we now missing?
the  20250708  hycom forecast is missing
0  files out of  453
the  20250709  hycom forecast is missing
57  files out of  453
the oldest forecast is the only full forecast!
which hycom forecast has the times we need for the PFM simulation?
for the PFM simulation starting from  2025-07-10 12:00:00
and ending at  2025-07-15 12:00:00
for the  20250708  hycom forecast, we are missing
0  files.
for the  20250709  hycom forecast, we are missing
25  files.
so we will use the
20250708  hycom simulation for this PFM forecast

Directory '/home/mspydell/models/PFM_root/PFM/driver/tds.hycom.org' deleted successfully.


we will use the hycom forecast from
20250708
for the PFM forecast.
...done.
this took:
0:00:04.569248


making the hycom pickle file from all hycom.nc files ...
all hycom nc files are the correct size, moving on!

max and min raw hycom data (iz is top [0] to bottom [39]):
max zeta   =  1.335 m          at  ( it, ilat, ilon)     =  ( 66, 133,  71)
min zeta   = -1.149 m          at  ( it, ilat, ilon)     =  ( 24,  84,  90)
max u      =  0.529 m/s        at  ( it, iz, ilat, ilon) =  ( 36,  0,  66,  57)
min u      = -0.584 m/s        at  ( it, iz, ilat, ilon) =  ( 25,  2,   0,  99)
max v      =  0.591 m/s        at  ( it, iz, ilat, ilon) =  ( 19,  0, 142,  56)
min v      = -0.739 m/s        at  ( it, iz, ilat, ilon) =  (  8,  0, 143,   1)
max temp   = 24.813 C          at  ( it, iz, ilat, ilon) =  ( 36,  0, 105,  84)
min temp   =  1.382 C          at  ( it, iz, ilat, ilon) =  ( 16, 38,  74,   2)
max dT/dz  =  2.774 C/m        at  ( it, iz, ilat, ilon) =  ( 21,  2, 128,  76)
min dT/dz  = -0.149 C/m        at  ( it, iz, ilat, ilon) =  (  6, 13, 121,  56)
max salt   = 34.722 psu        at  ( it, iz, ilat, ilon) =  ( 26, 38, 113,  28)
min salt   = 32.802 psu        at  ( it, iz, ilat, ilon) =  (  0, 10,  89,  32)
max dS/dz  =  0.048 psu/m      at  ( it, iz, ilat, ilon) =  ( 40,  3, 111,  53)
min dS/dz  = -0.035 psu/m      at  ( it, iz, ilat, ilon) =  ( 31,  1,  65,  16)

Hycom OCN dict saved with pickle
did subprocess run correctly? 0 (0=yes,1=no)
...done.
this took:
0:00:04.531943


making some plots from: /scratch/matt/PFM_Simulations_v2/LV1/Forc/hycom_tmp_pckl_file.pkl
/scratch/matt/PFM_Simulations_v2/LV1/Forc/hycom_tmp_pckl_file.pkl
OCN dict loaded with pickle
subprocess return code? 0 (0=good)
...done
this took:
0:00:05.081879


putting the hycom data in /scratch/matt/PFM_Simulations_v2/LV1/Forc/hycom_tmp_pckl_file.pkl on the roms grid...
...done. 
all 18 ocnR pickle files were made correctly
subprocess return code? 0 (0=good)
driver_run_forecast_LV1: done with hycom_to_roms_latlon
plotting LV1 ocn_R_fields...
subprocess return code? 0 (0=good)
...done with LV1 ocn_R
this took:
0:02:28.419282


making the depth pickle file...
/scratch/matt/PFM_Simulations_v2/LV1/Forc/roms_tmp_depth_file.pkl
ROMS depths for IC/BC saved with pickle to /scratch/matt/PFM_Simulations_v2/LV1/Forc/roms_tmp_depth_file.pkl
...done makeing depth pickle file.
subprocess return code? 0 (0=good)


going to use a restart file for the LV1 IC. Setting this up...
going to restart LV1 from
2025-07-10 12:00:00
found the time index!
going to restart using /scratch/PFM_Simulations/restart_data/LV1_ocean_rst_202507100600_202507150600.nc and python-index 0
removing ocean restart files older than now - 7.0 days old...
there were no ocean restart files older than now minus 7.0 days old
PFM info was edited and resaved
...done setting up for restart.
this took:
0:00:00.958668

Going to use the file LV1_ocean_rst_202507100600_202507150600.nc to restart the simulation
with time index 1


going to save OCN_BC to a pickle file to:
/scratch/matt/PFM_Simulations_v2/LV1/Forc/ocnBC_tmp_pckl_file.pkl
loading /scratch/matt/PFM_Simulations_v2/LV1/Forc/roms_tmp_depth_file.pkl
OCN BC data saved with pickle, correctly? 0 (0=yes)
this took:
0:00:12.077033


making BC nc file from pickled BC: /scratch/matt/PFM_Simulations_v2/LV1/Forc/LV1_OCEAN_BC.nc
OCN_BC dict loaded with pickle

max and min of data in ROMS BC file (iz is bottom [0] to top [39]):
max zeta_north =  1.007 m          at  ( it, ilon)     =  ( 42, 128)
min zeta_north = -1.082 m          at  ( it, ilon)     =  (  0, 116)
max zeta_south =  1.259 m          at  ( it, ilon)     =  ( 41, 139)
min zeta_south = -1.016 m          at  ( it, ilon)     =  ( 24, 246)
max zeta_west  =  1.180 m          at  ( it, ilat)     =  ( 16,  48)
min zeta_west  = -1.008 m          at  ( it, ilat)     =  (  0, 345)
max ubar_north =  0.035 m/s        at  ( it, ilon)     =  (  8, 108)
min ubar_north = -0.025 m/s        at  ( it, ilon)     =  (  2, 127)
max ubar_south =  0.036 m/s        at  ( it, ilon)     =  (  0, 239)
min ubar_south = -0.123 m/s        at  ( it, ilon)     =  ( 23, 240)
max ubar_west  =  0.037 m/s        at  ( it, ilat)     =  (  0,  92)
min ubar_west  = -0.041 m/s        at  ( it, ilat)     =  (  6, 179)
max vbar_north =  0.236 m/s        at  ( it, ilon)     =  ( 35, 124)
min vbar_north = -0.070 m/s        at  ( it, ilon)     =  (  8,  43)
max vbar_south =  0.157 m/s        at  ( it, ilon)     =  ( 22, 235)
min vbar_south = -0.096 m/s        at  ( it, ilon)     =  ( 16, 184)
max vbar_west  =  0.059 m/s        at  ( it, ilat)     =  ( 22, 129)
min vbar_west  = -0.077 m/s        at  ( it, ilat)     =  (  8, 372)
max u_north    =  0.341 m/s        at  ( it, iz, ilon) =  ( 21,  39,  58)
min u_north    = -0.514 m/s        at  ( it, iz, ilon) =  (  3,  38,  18)
max u_south    =  0.333 m/s        at  ( it, iz, ilon) =  ( 12,  39, 217)
min u_south    = -0.240 m/s        at  ( it, iz, ilon) =  ( 31,  39, 231)
max u_west     =  0.412 m/s        at  ( it, iz, ilat) =  ( 20,  35, 113)
min u_west     = -0.530 m/s        at  ( it, iz, ilat) =  (  4,  37, 183)
max v_north    =  0.440 m/s        at  ( it, iz, ilon) =  ( 30,  21, 120)
min v_north    = -0.422 m/s        at  ( it, iz, ilon) =  (  3,  39,  38)
max v_south    =  0.411 m/s        at  ( it, iz, ilon) =  ( 18,  39, 216)
min v_south    = -0.538 m/s        at  ( it, iz, ilon) =  ( 13,  39, 177)
max v_west     =  0.256 m/s        at  ( it, iz, ilat) =  ( 18,  35, 115)
min v_west     = -0.493 m/s        at  ( it, iz, ilat) =  (  0,  39, 374)
max temp_north = 18.468 C          at  ( it, iz, ilon) =  ( 36,  39,  71)
min temp_north =  1.077 C          at  ( it, iz, ilon) =  ( 12,   0,   4)
max temp_south = 22.461 C          at  ( it, iz, ilon) =  ( 28,  39, 246)
min temp_south =  1.122 C          at  ( it, iz, ilon) =  (  3,   0,   0)
max temp_west  = 21.275 C          at  ( it, iz, ilat) =  ( 37,  39,   0)
min temp_west  =  1.073 C          at  ( it, iz, ilat) =  ( 29,   0, 361)
max salt_north = 34.708 psu        at  ( it, iz, ilon) =  (  0,   0,  22)
min salt_north = 33.075 psu        at  ( it, iz, ilon) =  ( 27,  29,   2)
max salt_south = 34.708 psu        at  ( it, iz, ilon) =  (  3,   0,   0)
min salt_south = 33.305 psu        at  ( it, iz, ilon) =  ( 18,  25,  73)
max salt_west  = 34.710 psu        at  ( it, iz, ilat) =  ( 26,   0,  65)
min salt_west  = 32.967 psu        at  ( it, iz, ilat) =  ( 40,  31, 188)
OCN BC nc data saved, correctly? 0 (0=yes)
done makeing BC nc file.
this took:
0:00:00.967007


we are now getting the atm data and saving as a dict...
there are 101 ecmwf grib files to stack in time.

ecmwf 1st ATM dict saved with pickle.

ecmwf ATM dict roms vars saved with pickle.
trying the new more robust method of getting and using ecmwf data from cdip...
getting the ecmwf data from cdip for the 2025071012 forecast...
return code: 0 (0=good)
did we get the ecmwf data?
we got the files from the ecmwf forecast  2025071012
to do the PFM forecast starting on  2025071012
...done.

putting all grib data into a single pickle file...
return code: 0 (0=good)
...done.
deleting grb and idx files from  /scratch/PFM_Simulations/ecmwf_data/  ...
deleting  202  files...
deleting  0  files...
...done

going from ecmwf variables to roms variables...
return code: 0 (0=good)
...done.
return code: 0 (0=good)
...done.
this took:
0:00:08.417754


we are now putting the atm data on the roms LV1 grid...
loading /scratch/matt/PFM_Simulations_v2/LV1/Forc/atm_tmp_pckl_file.pkl ...
interpolating to LV1 grid...
... done.
rotating velocities to LV 1 roms directions...
...done.
saving atm to LV1 pkl file...

ATM on roms grid dict saved with pickle.
return code: 0 (0=good)
...done.
this took:
0:00:03.373495


we are now saving ATM LV1 to /scratch/matt/PFM_Simulations_v2/LV1/Forc/LV1_ATM_FORCING.nc ...
return code: 0 (0=good)
...done.
this took:
0:00:01.208727


driver_run_forecast_LV1:  making .in and .sb files...
loading model info...
...done
for this LV1 simulation
history file made will be:
/scratch/matt/PFM_Simulations_v2/LV1/His/LV1_ocean_his_202507101200.nc
restart file made will be:
/scratch/PFM_Simulations/restart_data/LV1_ocean_rst_202507101200_202507151200.nc
the ini file used is:
/scratch/PFM_Simulations/restart_data/LV1_ocean_rst_202507100600_202507150600.nc
we are using
/scratch/PFM_Simulations/executables/LV3_romsM_INTEL
...done.

now running roms LV1 with slurm.
using 6 nodes.
Ni = 9, NJ = 24
run_slurm_LV1: current directory is now:  /scratch/matt/PFM_Simulations_v2/LV1/Run
CompletedProcess(args=['sbatch', '--wait', 'LV1_SLURM.sb'], returncode=0, stdout=b'Submitted batch job 2393\n', stderr=b'')
subprocess slurm ran correctly? 0 (0=yes)
run_slurm_LV1: run command:  ['sbatch', '--wait', 'LV1_SLURM.sb']
...done.
this took:
0:07:06.044318


...finished LV1 forecast.
return code: 0 (0=good)
done with LV1
LV1  forecast ran correctly? 0 (0=yes)
this took:
0:10:28.575925



--------------------------
starting LV2
starting LV2 forecast with subprocess...

we are now putting the fore atm data on the roms LV2 grid...
loading /scratch/matt/PFM_Simulations_v2/LV1/Forc/atm_tmp_pckl_file.pkl ...
interpolating to LV2 grid...
... done.
rotating velocities to LV 2 roms directions...
...done.
saving atm to LV2 pkl file...

ATM on roms grid dict saved with pickle.
return code: 0 (0=good)
...done.
this took:
0:00:03.323452


we are now saving ATM LV2 to /scratch/matt/PFM_Simulations_v2/LV2/Forc/LV2_ATM_FORCING.nc ...
return code: 0 (0=good)
...done.
this took:
0:00:01.220209


driver_run_forcast_LV2: saving LV2_OCN_BC pickle file
interpolating z with normal loops.
OCN_LV 2 _BC dict saved with pickle to:  /scratch/matt/PFM_Simulations_v2/LV2/Forc/BC_LV2_tmp_file.pkl
return code: 0 (0=good)
driver_run_forecast_LV2:  done with writing LV2_OCN_BC.pkl file.
this took:
0:03:57.311960


driver_run_forcast_LV2: saving LV2_OCN_BC netcdf file
OCN_BC dict loaded with pickle

max and min of data in ROMS BC file (iz is bottom [0] to top [39]):
max zeta_north =  1.214 m          at  ( it, ilon)     =  ( 16, 161)
min zeta_north = -1.097 m          at  ( it, ilon)     =  ( 49,  44)
max zeta_south =  1.119 m          at  ( it, ilon)     =  ( 16, 203)
min zeta_south = -1.058 m          at  ( it, ilon)     =  ( 24,  95)
max zeta_west  =  1.108 m          at  ( it, ilat)     =  ( 16,   0)
min zeta_west  = -1.099 m          at  ( it, ilat)     =  (  0, 269)
max ubar_north =  0.207 m/s        at  ( it, ilon)     =  ( 82, 224)
min ubar_north = -0.359 m/s        at  ( it, ilon)     =  ( 19, 224)
max ubar_south =  0.094 m/s        at  ( it, ilon)     =  (100, 245)
min ubar_south = -0.253 m/s        at  ( it, ilon)     =  ( 92, 251)
max ubar_west  =  0.203 m/s        at  ( it, ilat)     =  (  8, 215)
min ubar_west  = -0.253 m/s        at  ( it, ilat)     =  ( 40, 326)
max vbar_north =  0.321 m/s        at  ( it, ilon)     =  (100, 193)
min vbar_north = -0.221 m/s        at  ( it, ilon)     =  ( 97, 130)
max vbar_south =  0.187 m/s        at  ( it, ilon)     =  ( 54, 143)
min vbar_south = -0.217 m/s        at  ( it, ilon)     =  (  8, 255)
max vbar_west  =  0.134 m/s        at  ( it, ilat)     =  ( 55, 174)
min vbar_west  = -0.338 m/s        at  ( it, ilat)     =  (111, 328)
max u_north    =  0.568 m/s        at  ( it, iz, ilon) =  ( 57,  39, 135)
min u_north    = -0.625 m/s        at  ( it, iz, ilon) =  ( 19,  37,  66)
max u_south    =  0.449 m/s        at  ( it, iz, ilon) =  (107,  39, 219)
min u_south    = -0.542 m/s        at  ( it, iz, ilon) =  ( 92,  39, 207)
max u_west     =  1.233 m/s        at  ( it, iz, ilat) =  ( 87,   0, 338)
min u_west     = -1.160 m/s        at  ( it, iz, ilat) =  ( 91,   0, 338)
max v_north    =  0.684 m/s        at  ( it, iz, ilon) =  ( 98,  39,  62)
min v_north    = -0.589 m/s        at  ( it, iz, ilon) =  ( 89,  39,   0)
max v_south    =  0.578 m/s        at  ( it, iz, ilon) =  (  0,  31, 149)
min v_south    = -0.831 m/s        at  ( it, iz, ilon) =  (  4,  39,  35)
max v_west     =  0.714 m/s        at  ( it, iz, ilat) =  ( 47,   0, 337)
min v_west     = -0.963 m/s        at  ( it, iz, ilat) =  (108,  39, 336)
max temp_north = 22.957 C          at  ( it, iz, ilon) =  ( 35,  39, 161)
min temp_north =  4.008 C          at  ( it, iz, ilon) =  ( 17,   0,   5)
max temp_south = 22.152 C          at  ( it, iz, ilon) =  (109,  39, 182)
min temp_south =  2.018 C          at  ( it, iz, ilon) =  ( 75,   0,   0)
max temp_west  = 21.034 C          at  ( it, iz, ilat) =  (108,  39, 397)
min temp_west  =  1.780 C          at  ( it, iz, ilat) =  (114,   0,  23)
max salt_north = 34.638 psu        at  ( it, iz, ilon) =  (110,   0,  13)
min salt_north = 33.436 psu        at  ( it, iz, ilon) =  (  0,  26, 104)
max salt_south = 34.632 psu        at  ( it, iz, ilon) =  ( 75,   0,   0)
min salt_south = 33.249 psu        at  ( it, iz, ilon) =  (100,  25,   0)
max salt_west  = 34.648 psu        at  ( it, iz, ilat) =  (115,   0,  23)
min salt_west  = 33.246 psu        at  ( it, iz, ilat) =  ( 95,  24,  11)
return code: 0 (0=good)
driver_run_forecast_LV2:  done with writing LV2_OCN_BC.nc file.
this took:
0:00:01.071012


going to use a restart file for the LV2 IC. Setting this up...
going to restart LV2 from
2025-07-10 12:00:00
found the time index!
going to restart using /scratch/PFM_Simulations/restart_data/LV2_ocean_rst_202507100600_202507150600.nc and python-index 0
PFM info was edited and resaved
...done setting up for restart.
this took:
0:00:00.862695

Going to use the file LV2_ocean_rst_202507100600_202507150600.nc to restart the simulation
with time index 1


making .in and .sb...
 --- making dot_in and dot_sb --- 
for this LV2 simulation
history file made will be:
/scratch/matt/PFM_Simulations_v2/LV2/His/LV2_ocean_his_202507101200.nc
restart file made will be:
/scratch/PFM_Simulations/restart_data/LV2_ocean_rst_202507101200_202507151200.nc
the ini file used is:
/scratch/PFM_Simulations/restart_data/LV2_ocean_rst_202507100600_202507150600.nc
we are using
/scratch/PFM_Simulations/executables/LV3_romsM_INTEL
...done
now running roms LV2 with slurm.
using 6 nodes.
Ni = 9, NJ = 24
working...
 --- running LV2 --- 
run_slurm_LV2: current directory is now:  /scratch/matt/PFM_Simulations_v2/LV2/Run
run_slurm_LV2: run command:  ['sbatch', '--wait', 'LV2_SLURM.sb']
subprocess slurm ran correctly? 0 (0=yes)
running ROMS took:
0:13:30.060470


...finished LV2 forecast.
return code: 0 (0=good)
done with LV2
LV2  forecast ran correctly? 0 (0=yes)
this took:
0:17:34.763391



--------------------------
starting LV3
starting LV3 forecast with subprocess...

we are now putting the fore atm data on the roms LV3 grid...
loading /scratch/matt/PFM_Simulations_v2/LV1/Forc/atm_tmp_pckl_file.pkl ...
interpolating to LV3 grid...
... done.
rotating velocities to LV 3 roms directions...
...done.
saving atm to LV3 pkl file...

ATM on roms grid dict saved with pickle.
return code: 0 (0=good)
...done.
this took:
0:00:03.302273


we are now saving ATM LV3 to /scratch/matt/PFM_Simulations_v2/LV3/Forc/LV3_ATM_FORCING.nc ...
return code: 0 (0=good)
...done.
this took:
0:00:01.205098


driver_run_forcast_LV3: saving LV3_OCN_BC pickle file
interpolating z with normal loops.
OCN_LV 3 _BC dict saved with pickle to:  /scratch/matt/PFM_Simulations_v2/LV3/Forc/BC_LV3_tmp_file.pkl
return code: 0 (0=good)
driver_run_forecast_LV3:  done with writing LV3_OCN_BC.pkl file.
this took:
0:04:23.181324


driver_run_forcast_LV3: saving LV3_OCN_BC netcdf file
OCN_BC dict loaded with pickle

max and min of data in ROMS BC file (iz is bottom [0] to top [39]):
max zeta_north =  1.124 m          at  ( it, ilon)     =  ( 16, 101)
min zeta_north = -0.964 m          at  ( it, ilon)     =  ( 24, 233)
max zeta_south =  1.129 m          at  ( it, ilon)     =  ( 16,   8)
min zeta_south = -0.985 m          at  ( it, ilon)     =  ( 24, 182)
max zeta_west  =  1.129 m          at  ( it, ilat)     =  ( 16,   8)
min zeta_west  = -0.946 m          at  ( it, ilat)     =  ( 24, 332)
max ubar_north =  0.256 m/s        at  ( it, ilon)     =  ( 32, 249)
min ubar_north = -0.352 m/s        at  ( it, ilon)     =  (117, 248)
max ubar_south =  0.214 m/s        at  ( it, ilon)     =  ( 34, 191)
min ubar_south = -0.244 m/s        at  ( it, ilon)     =  ( 93, 191)
max ubar_west  =  0.071 m/s        at  ( it, ilat)     =  ( 27, 209)
min ubar_west  = -0.071 m/s        at  ( it, ilat)     =  (  2,   2)
max vbar_north =  0.242 m/s        at  ( it, ilon)     =  (114, 226)
min vbar_north = -0.370 m/s        at  ( it, ilon)     =  ( 14, 240)
max vbar_south =  0.201 m/s        at  ( it, ilon)     =  (115, 170)
min vbar_south = -0.321 m/s        at  ( it, ilon)     =  ( 63, 250)
max vbar_west  =  0.059 m/s        at  ( it, ilat)     =  ( 15,   0)
min vbar_west  = -0.181 m/s        at  ( it, ilat)     =  ( 72, 360)
max u_north    =  0.377 m/s        at  ( it, iz, ilon) =  (105,  39,  39)
min u_north    = -0.679 m/s        at  ( it, iz, ilon) =  (119,  39, 114)
max u_south    =  0.505 m/s        at  ( it, iz, ilon) =  (111,   0, 159)
min u_south    = -0.582 m/s        at  ( it, iz, ilon) =  ( 29,   0, 160)
max u_west     =  0.468 m/s        at  ( it, iz, ilat) =  (106,  39, 263)
min u_west     = -0.460 m/s        at  ( it, iz, ilat) =  ( 17,  38,  92)
max v_north    =  0.424 m/s        at  ( it, iz, ilon) =  (120,  39, 203)
min v_north    = -0.584 m/s        at  ( it, iz, ilon) =  ( 14,  39, 230)
max v_south    =  0.429 m/s        at  ( it, iz, ilon) =  ( 25,   0, 133)
min v_south    = -0.499 m/s        at  ( it, iz, ilon) =  ( 10,  39, 149)
max v_west     =  0.407 m/s        at  ( it, iz, ilat) =  (  0,  35, 405)
min v_west     = -0.581 m/s        at  ( it, iz, ilat) =  (109,  39, 225)
max temp_north = 23.010 C          at  ( it, iz, ilon) =  ( 11,  39, 241)
min temp_north =  4.197 C          at  ( it, iz, ilon) =  ( 38,   0,  30)
max temp_south = 22.527 C          at  ( it, iz, ilon) =  ( 60,  39, 189)
min temp_south =  3.233 C          at  ( it, iz, ilon) =  ( 43,   0,  40)
max temp_west  = 22.499 C          at  ( it, iz, ilat) =  (109,  39,   9)
min temp_west  =  3.165 C          at  ( it, iz, ilat) =  ( 22,   0,  49)
max salt_north = 34.491 psu        at  ( it, iz, ilon) =  ( 39,   0,  29)
min salt_north = 33.447 psu        at  ( it, iz, ilon) =  (  0,  24,  29)
max salt_south = 34.540 psu        at  ( it, iz, ilon) =  ( 43,   0,  40)
min salt_south = 33.352 psu        at  ( it, iz, ilon) =  (118,  26,   0)
max salt_west  = 34.545 psu        at  ( it, iz, ilat) =  ( 22,   0,  49)
min salt_west  = 33.352 psu        at  ( it, iz, ilat) =  (118,  26,   0)
return code: 0 (0=good)
driver_run_forecast_LV3:  done with writing LV2_OCN_BC.nc file.
this took:
0:00:01.075719


going to use a restart file for the LV3 IC. Setting this up...
going to restart LV3 from
2025-07-10 12:00:00
found the time index!
going to restart using /scratch/PFM_Simulations/restart_data/LV3_ocean_rst_202507100600_202507150600.nc and python-index 0
PFM info was edited and resaved
...done setting up for restart.
this took:
0:00:00.866236

Going to use the file LV3_ocean_rst_202507100600_202507150600.nc to restart the simulation
with time index 1


making .in and .sb...
for this LV3 simulation
history file made will be:
/scratch/matt/PFM_Simulations_v2/LV3/His/LV3_ocean_his_202507101200.nc
restart file made will be:
/scratch/PFM_Simulations/restart_data/LV3_ocean_rst_202507101200_202507151200.nc
the ini file used is:
/scratch/PFM_Simulations/restart_data/LV3_ocean_rst_202507100600_202507150600.nc
we are using
/scratch/PFM_Simulations/executables/LV3_romsM_INTEL
...done
now running roms LV3 with slurm.
using 10 nodes.
Ni = 12, NJ = 30
working...
 --- running LV3 --- 
run_slurm_LV3: current directory is now:  /scratch/matt/PFM_Simulations_v2/LV3/Run
run_slurm_LV3: run command:  ['sbatch', '--wait', 'LV3_SLURM.sb']
subprocess slurm ran correctly? 0 (0=yes)
running ROMS took:
0:17:46.078178


...finished LV3 forecast.
return code: 0 (0=good)
done with LV3
LV3  forecast ran correctly? 0 (0=yes)
this took:
0:22:16.622245



--------------------------
starting LV4
starting LV4 forecast with subprocess...

we are now putting the fore atm data on the roms LV4 grid...
loading /scratch/matt/PFM_Simulations_v2/LV1/Forc/atm_tmp_pckl_file.pkl ...
interpolating to LV4 grid...
... done.
rotating velocities to LV 4 roms directions...
...done.
saving atm to LV4 pkl file...

ATM on roms grid dict saved with pickle.
return code: 0 (0=good)
...done.
this took:
0:00:15.439231


we are now saving ATM LV4 to /scratch/matt/PFM_Simulations_v2/LV4/Forc/LV4_ATM_FORCING.nc ...
return code: 0 (0=good)
...done.
this took:
0:00:02.511520


driver_run_forcast_LV4: saving LV4_OCN_BC pickle file
interpolating z with normal loops.
OCN_LV 4 _BC dict saved with pickle to:  /scratch/matt/PFM_Simulations_v2/LV4/Forc/BC_LV4_tmp_file.pkl
return code: 0 (0=good)
driver_run_forecast_LV4:  done with writing LV4_OCN_BC.pkl file.
this took:
0:05:14.690770


driver_run_forcast_LV4: saving LV4_OCN_BC netcdf file
OCN_BC dict loaded with pickle

max and min of data in ROMS BC file (iz is bottom [0] to top [39]):
max zeta_north =  1.110 m          at  ( it, ilon)     =  ( 16,  28)
min zeta_north = -0.991 m          at  ( it, ilon)     =  ( 24,  28)
max zeta_south =  1.104 m          at  ( it, ilon)     =  ( 16,  10)
min zeta_south = -0.994 m          at  ( it, ilon)     =  ( 24, 361)
max zeta_west  =  1.109 m          at  ( it, ilat)     =  ( 16,1140)
min zeta_west  = -0.984 m          at  ( it, ilat)     =  ( 24,1140)
max ubar_north =  0.278 m/s        at  ( it, ilon)     =  ( 58, 217)
min ubar_north = -0.122 m/s        at  ( it, ilon)     =  ( 14, 170)
max ubar_south =  0.237 m/s        at  ( it, ilon)     =  ( 60, 484)
min ubar_south = -0.119 m/s        at  ( it, ilon)     =  ( 93, 463)
max ubar_west  =  0.093 m/s        at  ( it, ilat)     =  (  1, 285)
min ubar_west  = -0.112 m/s        at  ( it, ilat)     =  (118,1015)
max vbar_north =  0.198 m/s        at  ( it, ilon)     =  ( 29,  32)
min vbar_north = -0.250 m/s        at  ( it, ilon)     =  (111,  63)
max vbar_south =  0.170 m/s        at  ( it, ilon)     =  (104,  11)
min vbar_south = -0.284 m/s        at  ( it, ilon)     =  ( 86, 478)
max vbar_west  =  0.190 m/s        at  ( it, ilat)     =  (114,1014)
min vbar_west  = -0.148 m/s        at  ( it, ilat)     =  ( 22,  13)
max u_north    =  0.356 m/s        at  ( it, iz, ilon) =  ( 29,   9,   0)
min u_north    = -0.216 m/s        at  ( it, iz, ilon) =  ( 29,   1,   5)
max u_south    =  0.306 m/s        at  ( it, iz, ilon) =  ( 59,   9,  19)
min u_south    = -0.257 m/s        at  ( it, iz, ilon) =  ( 94,   9,  14)
max u_west     =  0.429 m/s        at  ( it, iz, ilat) =  (106,   9, 866)
min u_west     = -0.318 m/s        at  ( it, iz, ilat) =  (120,   0,1013)
max v_north    =  0.297 m/s        at  ( it, iz, ilon) =  ( 30,   9,  21)
min v_north    = -0.349 m/s        at  ( it, iz, ilon) =  (112,   9,   0)
max v_south    =  0.231 m/s        at  ( it, iz, ilon) =  (117,   2,  11)
min v_south    = -0.439 m/s        at  ( it, iz, ilon) =  ( 12,   9,  59)
max v_west     =  0.290 m/s        at  ( it, iz, ilat) =  (100,   6,1023)
min v_west     = -0.453 m/s        at  ( it, iz, ilat) =  ( 10,   9, 624)
max temp_north = 22.505 C          at  ( it, iz, ilon) =  ( 59,   0,  32)
min temp_north = 12.623 C          at  ( it, iz, ilon) =  ( 16,   0,   0)
max temp_south = 22.299 C          at  ( it, iz, ilon) =  ( 59,   0, 384)
min temp_south = 12.765 C          at  ( it, iz, ilon) =  (118,   0,   6)
max temp_west  = 22.796 C          at  ( it, iz, ilat) =  ( 60,   9, 887)
min temp_west  = 11.996 C          at  ( it, iz, ilat) =  ( 32,   0, 783)
max salt_north = 33.629 psu        at  ( it, iz, ilon) =  ( 16,   0,   0)
min salt_north = 33.548 psu        at  ( it, iz, ilon) =  ( 95,   4,   0)
max salt_south = 33.617 psu        at  ( it, iz, ilon) =  ( 35,   0,  82)
min salt_south = 33.417 psu        at  ( it, iz, ilon) =  ( 96,   4,   4)
max salt_west  = 33.691 psu        at  ( it, iz, ilat) =  (102,   9, 990)
min salt_west  = 33.407 psu        at  ( it, iz, ilat) =  ( 88,   4, 308)
return code: 0 (0=good)
driver_run_forecast_LV4:  done with writing LV4_OCN_BC.nc file.
this took:
0:00:01.016187


going to use a restart file for the LV4 IC. Setting this up...
going to restart LV4 from
2025-07-10 12:00:00
found the time index!
going to restart using /scratch/PFM_Simulations/restart_data/LV4_ocean_rst_202507100600_202507150600.nc and python-index 0
going to deleting swan base rst files...
deleting some files...
removing swan restart files older than now - 7.0 days old...
there were no swan restart files older than now minus 7.0 days old
a previous forecast was run from this start time. Swan restart files from this forecast were deleted.
going to restart swan, forecast start time is
2025-07-10 12:00:00
we are going to restart swan with the line ...
HOTSTART '/scratch/PFM_Simulations/restart_data/LV4_swan_rst_202507100600_006.dat'
PFM info was edited and resaved
...done setting up for restart.
this took:
0:00:01.372756

Going to use the file LV4_ocean_rst_202507100600_202507150600.nc to restart the simulation
with time index 1


driver_run_forcast_LV4: making clm.nc, nud.nc, and river.nc files...
OCN_BC dict loaded with pickle
clm return code: 0 (0=good)
nud return code: 0 (0=good)
making river tracer dictionary
making the river discharge pickle file
using the nwm river forecast from the start time:
2025071006
to ensure that the forecast can be found on their server

river discharge data saved as pickle file
loading the river discharge pickle file...
the time-mean discharge for TJR is 
-0.7339024226203925 m3/s
or  -16.750588893887837 MGD
the time-mean discharge for Sweetwater is 
-1.9996747520517528 m3/s
or  -45.64057654082921 MGD
the time-mean discharge for Otay Mesa is 
-0.9026016058415417 m3/s
or  -20.60097905172735 MGD
the time-constant discharge for Punta Bandera is 
-2.0 m3/s
or  -45.648 MGD
getting the river temperature. For each river, each time, and depth,
      it is the mean air temp over the LV4 land domain...
the time-mean river dye for Punta Bandera is 
0.5
the time-mean river dye for TJRE is 
0.6500000000000002
the time-mean river temp for all rivers is 
19.46170396311641
river return code: 0 (0=good)
driver_run_forecast_L4:  done making clm, nud, and river.nc files.
this took:
0:03:13.574730


driver_run_forcast_LV4: making swan bnd and wnd files...
removing previous cdip .nc files...
...done. getting new cdip .nc files...
...done. making dictionary of cdip data...
...done.

CDIP data saved as pickle file
cdip to dictionary return code: 0 (0=good)
making swan .bnd file...

CDIP pickle file loaded
...done. swan bnd file return code: 0 (0=good)
making swan wnd file...
...done. swan wnd file return code: 0 (0=good)
...done. making swan .bnd and .wnd files took:
0:04:20.193682
making LV4 ocean, swan, coupling .in and .sb...
we are using
/scratch/PFM_Simulations/executables/coawstM_intel
for LV4
...done
now running Coawst LV4 with slurm.
using 14 nodes (= 504 CPUs.)
using 432 CPUs for ROMS, with tiling:
Ni = 12, NJ = 36
and using 72 CPUs for SWAN.
working...
starting the background process that looks for modified swan restart files
we check for modified files every 144 s (wall time)
run_slurm_LV4: current directory is now:  /scratch/matt/PFM_Simulations_v2/LV4/Run
terminated the swan restart file check and move subprocess.
CompletedProcess(args=['sbatch', '--wait', 'LV4_SLURM.sb'], returncode=1, stdout=b'Submitted batch job 2396\n', stderr=b'')
run_slurm_LV4: run command:  ['sbatch', '--wait', 'LV4_SLURM.sb']
subprocess slurm ran correctly? 1 (0=yes)
...done.
this took:
2:28:42.481081


now making LV4 history file plots...
getting clims...
...done.
...done plotting LV4: 0 (0=good)
this took:
0:02:13.557352
now making LV4 dye plots...
...done plotting LV4: 0 (0=good)
this took:
0:02:24.582875

moving LV4 atm and river files to Archive...
...done
making the web netcdf file...
...done making web nc file: 0 (0=good)
this took:
0:00:10.612679
OCN_LV4 timing info dict saved with pickle to:  /scratch/matt/PFM_Simulations_v2/LV4/Run/LV4_timing_info.pkl
...finished LV4 forecast.
return code: 0 (0=good)
