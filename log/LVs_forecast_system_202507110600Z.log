initializing model and making the info.pkl file.
The model information in:
/home/mspydell/models/PFM_root/PFM/sdpm_py_util/pfm_input_v2p0.py
is turned into a .pkl file of model info.
The model_info dictionary is saved to /scratch/matt/PFM_Simulations_v2/forecast_info.pkl
This file dictates how the model is run, where files are saved, etc.

------------------------------------------------------------
                        Model Set Up                        
------------------------------------------------------------
forecast                                                    
from           : 2025-07-11 06:00                           
to             : 2025-07-16 06:00                           
in a           : 5.0 day chunk                              
atm model      : ecmwf                                      
ocean_model    : hycom_new                                  
running levels : LV1, LV2, LV3, LV4                         

===========================
!!!starting the forecast with subprocess!!!
current time is:  2025-07-11 07:30:03.546439
===========================
Starting the loop over levels to run!

--------------------------
starting LV1
starting LV1 forecast with subprocess...
We are starting clean.
Removing files from directories...
...done.
202507110600

Going to do a PFM forecast from
2025-07-11 06:00:00
to
2025-07-16 06:00:00
getting the hycom forecast time...
this will clean, download new hycom files, then find the forecast date covering the PFM times.
we currently have hycom forecasts starting from:
['2025-07-08', '2025-07-09', '2025-07-10']
checking to see if we are missing any files...
we are missing 348 files from these forecasts.
attempting to get these files ...
getting <=10 hycom files... done
getting <=10 hycom files... done
getting <=10 hycom files... done
getting <=10 hycom files... done
getting <=10 hycom files... done
getting <=10 hycom files... done
getting <=10 hycom files... done
getting <=10 hycom files... done
getting <=10 hycom files... done
getting <=10 hycom files... done
getting <=10 hycom files... done
getting <=10 hycom files... done
getting <=10 hycom files... done
getting <=10 hycom files... done
getting <=10 hycom files... done
getting <=10 hycom files... done
getting <=10 hycom files... done
getting <=10 hycom files... done
getting <=10 hycom files... done
getting <=10 hycom files... done
getting <=10 hycom files... done
getting <=10 hycom files... done
getting <=10 hycom files... done
getting <=10 hycom files... done
getting <=10 hycom files... done
getting <=10 hycom files... done
getting <=10 hycom files... done
getting <=10 hycom files... done
getting <=10 hycom files... done
getting <=10 hycom files... done
getting <=10 hycom files... done
getting <=10 hycom files... done
getting <=10 hycom files... done
getting <=10 hycom files... done
getting <=10 hycom files... done
...done
we are now missing 57 files from these forecasts.

attempting to get a new hycom forecast...
no need to get a new forecast. We are up to date.
now how many total files are we now missing?
the  20250708  hycom forecast is missing
0  files out of  453
the  20250709  hycom forecast is missing
1  files out of  453
the  20250710  hycom forecast is missing
56  files out of  453
the oldest forecast is the only full forecast!
which hycom forecast has the times we need for the PFM simulation?
for the PFM simulation starting from  2025-07-11 06:00:00
and ending at  2025-07-16 06:00:00
for the  20250708  hycom forecast, we are missing
0  files.
for the  20250709  hycom forecast, we are missing
1  files.
for the  20250710  hycom forecast, we are missing
20  files.
so we will use the
20250708  hycom simulation for this PFM forecast

Directory '/home/mspydell/models/PFM_root/PFM/driver/tds.hycom.org' deleted successfully.


we will use the hycom forecast from
20250708
for the PFM forecast.
...done.
this took:
0:01:25.729850


making the hycom pickle file from all hycom.nc files ...
all hycom nc files are the correct size, moving on!

max and min raw hycom data (iz is top [0] to bottom [39]):
max zeta   =  1.335 m          at  ( it, ilat, ilon)     =  ( 48, 133,  71)
min zeta   = -1.149 m          at  ( it, ilat, ilon)     =  (  6,  84,  90)
max u      =  0.611 m/s        at  ( it, iz, ilat, ilon) =  ( 38,  0,  66,  56)
min u      = -0.584 m/s        at  ( it, iz, ilat, ilon) =  ( 19,  2,   0,  99)
max v      =  0.591 m/s        at  ( it, iz, ilat, ilon) =  ( 13,  0, 142,  56)
min v      = -0.739 m/s        at  ( it, iz, ilat, ilon) =  (  2,  0, 143,   1)
max temp   = 24.821 C          at  ( it, iz, ilat, ilon) =  ( 38,  0, 105,  84)
min temp   =  1.382 C          at  ( it, iz, ilat, ilon) =  ( 10, 38,  74,   2)
max dT/dz  =  2.774 C/m        at  ( it, iz, ilat, ilon) =  ( 15,  2, 128,  76)
min dT/dz  = -0.149 C/m        at  ( it, iz, ilat, ilon) =  (  0, 13, 121,  56)
max salt   = 34.722 psu        at  ( it, iz, ilat, ilon) =  ( 20, 38, 113,  28)
min salt   = 32.809 psu        at  ( it, iz, ilat, ilon) =  (  0, 10,  89,  31)
max dS/dz  =  0.049 psu/m      at  ( it, iz, ilat, ilon) =  ( 35,  3, 111,  53)
min dS/dz  = -0.035 psu/m      at  ( it, iz, ilat, ilon) =  ( 25,  1,  65,  16)

Hycom OCN dict saved with pickle
did subprocess run correctly? 0 (0=yes,1=no)
...done.
this took:
0:00:04.518157


making some plots from: /scratch/matt/PFM_Simulations_v2/LV1/Forc/hycom_tmp_pckl_file.pkl
/scratch/matt/PFM_Simulations_v2/LV1/Forc/hycom_tmp_pckl_file.pkl
OCN dict loaded with pickle
subprocess return code? 0 (0=good)
...done
this took:
0:00:05.067813


putting the hycom data in /scratch/matt/PFM_Simulations_v2/LV1/Forc/hycom_tmp_pckl_file.pkl on the roms grid...
...done. 
all 18 ocnR pickle files were made correctly
subprocess return code? 0 (0=good)
driver_run_forecast_LV1: done with hycom_to_roms_latlon
plotting LV1 ocn_R_fields...
subprocess return code? 0 (0=good)
...done with LV1 ocn_R
this took:
0:02:28.058465


making the depth pickle file...
/scratch/matt/PFM_Simulations_v2/LV1/Forc/roms_tmp_depth_file.pkl
ROMS depths for IC/BC saved with pickle to /scratch/matt/PFM_Simulations_v2/LV1/Forc/roms_tmp_depth_file.pkl
...done makeing depth pickle file.
subprocess return code? 0 (0=good)


going to use a restart file for the LV1 IC. Setting this up...
going to restart LV1 from
2025-07-11 06:00:00
found the time index!
going to restart using /scratch/PFM_Simulations/restart_data/LV1_ocean_rst_202507110000_202507160000.nc and python-index 0
removing ocean restart files older than now - 7.0 days old...
there were no ocean restart files older than now minus 7.0 days old
PFM info was edited and resaved
...done setting up for restart.
this took:
0:00:00.952501

Going to use the file LV1_ocean_rst_202507110000_202507160000.nc to restart the simulation
with time index 1


going to save OCN_BC to a pickle file to:
/scratch/matt/PFM_Simulations_v2/LV1/Forc/ocnBC_tmp_pckl_file.pkl
loading /scratch/matt/PFM_Simulations_v2/LV1/Forc/roms_tmp_depth_file.pkl
OCN BC data saved with pickle, correctly? 0 (0=yes)
this took:
0:00:11.978843


making BC nc file from pickled BC: /scratch/matt/PFM_Simulations_v2/LV1/Forc/LV1_OCEAN_BC.nc
OCN_BC dict loaded with pickle

max and min of data in ROMS BC file (iz is bottom [0] to top [39]):
max zeta_north =  1.007 m          at  ( it, ilon)     =  ( 24, 128)
min zeta_north = -1.076 m          at  ( it, ilon)     =  (  7, 107)
max zeta_south =  1.259 m          at  ( it, ilon)     =  ( 23, 139)
min zeta_south = -1.016 m          at  ( it, ilon)     =  (  6, 246)
max zeta_west  =  1.159 m          at  ( it, ilat)     =  ( 23,  48)
min zeta_west  = -0.995 m          at  ( it, ilat)     =  (  7, 347)
max ubar_north =  0.035 m/s        at  ( it, ilon)     =  (  2, 108)
min ubar_north = -0.023 m/s        at  ( it, ilon)     =  ( 29, 127)
max ubar_south =  0.034 m/s        at  ( it, ilon)     =  (  2, 108)
min ubar_south = -0.123 m/s        at  ( it, ilon)     =  ( 17, 240)
max ubar_west  =  0.037 m/s        at  ( it, ilat)     =  ( 31, 104)
min ubar_west  = -0.041 m/s        at  ( it, ilat)     =  (  0, 179)
max vbar_north =  0.236 m/s        at  ( it, ilon)     =  ( 29, 124)
min vbar_north = -0.070 m/s        at  ( it, ilon)     =  (  2,  43)
max vbar_south =  0.157 m/s        at  ( it, ilon)     =  ( 16, 235)
min vbar_south = -0.096 m/s        at  ( it, ilon)     =  ( 10, 184)
max vbar_west  =  0.059 m/s        at  ( it, ilat)     =  ( 16, 129)
min vbar_west  = -0.077 m/s        at  ( it, ilat)     =  (  2, 372)
max u_north    =  0.341 m/s        at  ( it, iz, ilon) =  ( 15,  39,  58)
min u_north    = -0.414 m/s        at  ( it, iz, ilon) =  (  0,  37,  10)
max u_south    =  0.333 m/s        at  ( it, iz, ilon) =  (  6,  39, 217)
min u_south    = -0.240 m/s        at  ( it, iz, ilon) =  ( 25,  39, 231)
max u_west     =  0.460 m/s        at  ( it, iz, ilat) =  ( 40,  39, 101)
min u_west     = -0.464 m/s        at  ( it, iz, ilat) =  ( 24,  39, 376)
max v_north    =  0.440 m/s        at  ( it, iz, ilon) =  ( 24,  21, 120)
min v_north    = -0.405 m/s        at  ( it, iz, ilon) =  (  2,  39,  42)
max v_south    =  0.411 m/s        at  ( it, iz, ilon) =  ( 12,  39, 216)
min v_south    = -0.538 m/s        at  ( it, iz, ilon) =  (  7,  39, 177)
max v_west     =  0.256 m/s        at  ( it, iz, ilat) =  ( 12,  35, 115)
min v_west     = -0.471 m/s        at  ( it, iz, ilat) =  (  2,  39, 374)
max temp_north = 19.147 C          at  ( it, iz, ilon) =  ( 38,  39,  67)
min temp_north =  1.077 C          at  ( it, iz, ilon) =  (  6,   0,   4)
max temp_south = 22.461 C          at  ( it, iz, ilon) =  ( 22,  39, 246)
min temp_south =  1.122 C          at  ( it, iz, ilon) =  (  5,   0,   0)
max temp_west  = 21.483 C          at  ( it, iz, ilat) =  ( 38,  39,   0)
min temp_west  =  1.073 C          at  ( it, iz, ilat) =  ( 35,   0, 361)
max salt_north = 34.708 psu        at  ( it, iz, ilon) =  (  0,   0,  22)
min salt_north = 33.075 psu        at  ( it, iz, ilon) =  ( 21,  29,   2)
max salt_south = 34.708 psu        at  ( it, iz, ilon) =  (  5,   0,   0)
min salt_south = 33.305 psu        at  ( it, iz, ilon) =  ( 12,  25,  73)
max salt_west  = 34.710 psu        at  ( it, iz, ilat) =  ( 20,   0,  65)
min salt_west  = 32.956 psu        at  ( it, iz, ilat) =  ( 38,  31, 200)
OCN BC nc data saved, correctly? 0 (0=yes)
done makeing BC nc file.
this took:
0:00:00.959353


we are now getting the atm data and saving as a dict...
there are 93 ecmwf grib files to stack in time.

ecmwf 1st ATM dict saved with pickle.

ecmwf ATM dict roms vars saved with pickle.
trying the new more robust method of getting and using ecmwf data from cdip...
getting the ecmwf data from cdip for the 2025071106 forecast...
return code: 0 (0=good)
did we get the ecmwf data?
getting the ecmwf data from cdip for the 2025071018 forecast...
return code: 0 (0=good)
did we get the ecmwf data?
we got the files from the ecmwf forecast  2025071018
to do the PFM forecast starting on  2025071106
...done.

putting all grib data into a single pickle file...
return code: 0 (0=good)
...done.
deleting grb and idx files from  /scratch/PFM_Simulations/ecmwf_data/  ...
deleting  287  files...
deleting  0  files...
...done

going from ecmwf variables to roms variables...
return code: 0 (0=good)
...done.
return code: 0 (0=good)
...done.
this took:
0:00:09.671809


we are now putting the atm data on the roms LV1 grid...
loading /scratch/matt/PFM_Simulations_v2/LV1/Forc/atm_tmp_pckl_file.pkl ...
interpolating to LV1 grid...
... done.
rotating velocities to LV 1 roms directions...
...done.
saving atm to LV1 pkl file...

ATM on roms grid dict saved with pickle.
return code: 0 (0=good)
...done.
this took:
0:00:03.146166


we are now saving ATM LV1 to /scratch/matt/PFM_Simulations_v2/LV1/Forc/LV1_ATM_FORCING.nc ...
return code: 0 (0=good)
...done.
this took:
0:00:01.151026


driver_run_forecast_LV1:  making .in and .sb files...
loading model info...
...done
for this LV1 simulation
history file made will be:
/scratch/matt/PFM_Simulations_v2/LV1/His/LV1_ocean_his_202507110600.nc
restart file made will be:
/scratch/PFM_Simulations/restart_data/LV1_ocean_rst_202507110600_202507160600.nc
the ini file used is:
/scratch/PFM_Simulations/restart_data/LV1_ocean_rst_202507110000_202507160000.nc
we are using
/scratch/PFM_Simulations/executables/LV3_romsM_INTEL
...done.

now running roms LV1 with slurm.
using 6 nodes.
Ni = 9, NJ = 24
run_slurm_LV1: current directory is now:  /scratch/matt/PFM_Simulations_v2/LV1/Run
CompletedProcess(args=['sbatch', '--wait', 'LV1_SLURM.sb'], returncode=0, stdout=b'Submitted batch job 2401\n', stderr=b'')
subprocess slurm ran correctly? 0 (0=yes)
run_slurm_LV1: run command:  ['sbatch', '--wait', 'LV1_SLURM.sb']
...done.
this took:
0:07:06.046745


...finished LV1 forecast.
return code: 0 (0=good)
done with LV1
LV1  forecast ran correctly? 0 (0=yes)
this took:
0:11:50.260363



--------------------------
starting LV2
starting LV2 forecast with subprocess...

we are now putting the fore atm data on the roms LV2 grid...
loading /scratch/matt/PFM_Simulations_v2/LV1/Forc/atm_tmp_pckl_file.pkl ...
interpolating to LV2 grid...
... done.
rotating velocities to LV 2 roms directions...
...done.
saving atm to LV2 pkl file...

ATM on roms grid dict saved with pickle.
return code: 0 (0=good)
...done.
this took:
0:00:03.214989


we are now saving ATM LV2 to /scratch/matt/PFM_Simulations_v2/LV2/Forc/LV2_ATM_FORCING.nc ...
return code: 0 (0=good)
...done.
this took:
0:00:01.178525


driver_run_forcast_LV2: saving LV2_OCN_BC pickle file
interpolating z with normal loops.
OCN_LV 2 _BC dict saved with pickle to:  /scratch/matt/PFM_Simulations_v2/LV2/Forc/BC_LV2_tmp_file.pkl
return code: 0 (0=good)
driver_run_forecast_LV2:  done with writing LV2_OCN_BC.pkl file.
this took:
0:03:59.538089


driver_run_forcast_LV2: saving LV2_OCN_BC netcdf file
OCN_BC dict loaded with pickle

max and min of data in ROMS BC file (iz is bottom [0] to top [39]):
max zeta_north =  1.164 m          at  ( it, ilon)     =  ( 23, 161)
min zeta_north = -1.095 m          at  ( it, ilon)     =  ( 31,  44)
max zeta_south =  1.104 m          at  ( it, ilon)     =  ( 23, 203)
min zeta_south = -1.058 m          at  ( it, ilon)     =  (  6,  95)
max zeta_west  =  1.100 m          at  ( it, ilat)     =  ( 23,   0)
min zeta_west  = -1.096 m          at  ( it, ilat)     =  ( 31, 386)
max ubar_north =  0.211 m/s        at  ( it, ilon)     =  ( 64, 224)
min ubar_north = -0.353 m/s        at  ( it, ilon)     =  (  1, 224)
max ubar_south =  0.121 m/s        at  ( it, ilon)     =  (109, 247)
min ubar_south = -0.237 m/s        at  ( it, ilon)     =  ( 74, 247)
max ubar_west  =  0.202 m/s        at  ( it, ilat)     =  ( 69, 338)
min ubar_west  = -0.253 m/s        at  ( it, ilat)     =  ( 22, 326)
max vbar_north =  0.326 m/s        at  ( it, ilon)     =  ( 82, 195)
min vbar_north = -0.220 m/s        at  ( it, ilon)     =  ( 79, 130)
max vbar_south =  0.187 m/s        at  ( it, ilon)     =  ( 36, 143)
min vbar_south = -0.222 m/s        at  ( it, ilon)     =  (116, 251)
max vbar_west  =  0.133 m/s        at  ( it, ilat)     =  ( 37, 174)
min vbar_west  = -0.424 m/s        at  ( it, ilat)     =  (117, 328)
max u_north    =  0.603 m/s        at  ( it, iz, ilon) =  ( 88,  39,  42)
min u_north    = -0.624 m/s        at  ( it, iz, ilon) =  (  2,  39,  69)
max u_south    =  0.564 m/s        at  ( it, iz, ilon) =  (113,  39, 216)
min u_south    = -0.545 m/s        at  ( it, iz, ilon) =  ( 74,  39, 204)
max u_west     =  1.298 m/s        at  ( it, iz, ilat) =  ( 69,   0, 338)
min u_west     = -1.169 m/s        at  ( it, iz, ilat) =  ( 73,   0, 338)
max v_north    =  0.687 m/s        at  ( it, iz, ilon) =  ( 80,  39,  59)
min v_north    = -0.597 m/s        at  ( it, iz, ilon) =  ( 71,  39,   0)
max v_south    =  0.633 m/s        at  ( it, iz, ilon) =  (106,  39, 164)
min v_south    = -0.808 m/s        at  ( it, iz, ilon) =  (118,  39,  23)
max v_west     =  0.726 m/s        at  ( it, iz, ilat) =  ( 29,   0, 337)
min v_west     = -0.965 m/s        at  ( it, iz, ilat) =  ( 90,  39, 333)
max temp_north = 22.983 C          at  ( it, iz, ilon) =  ( 17,  39, 161)
min temp_north =  4.009 C          at  ( it, iz, ilon) =  (  0,   0,   5)
max temp_south = 22.525 C          at  ( it, iz, ilon) =  (114,  39, 197)
min temp_south =  2.019 C          at  ( it, iz, ilon) =  ( 57,   0,   0)
max temp_west  = 21.357 C          at  ( it, iz, ilat) =  (115,  39, 397)
min temp_west  =  1.778 C          at  ( it, iz, ilat) =  (110,   0,  23)
max salt_north = 34.638 psu        at  ( it, iz, ilon) =  ( 92,   0,  13)
min salt_north = 33.461 psu        at  ( it, iz, ilon) =  (  0,  16, 143)
max salt_south = 34.632 psu        at  ( it, iz, ilon) =  ( 57,   0,   0)
min salt_south = 33.248 psu        at  ( it, iz, ilon) =  ( 82,  25,   0)
max salt_west  = 34.648 psu        at  ( it, iz, ilat) =  (110,   0,  23)
min salt_west  = 33.222 psu        at  ( it, iz, ilat) =  (120,  26,  41)
return code: 0 (0=good)
driver_run_forecast_LV2:  done with writing LV2_OCN_BC.nc file.
this took:
0:00:01.117098


going to use a restart file for the LV2 IC. Setting this up...
going to restart LV2 from
2025-07-11 06:00:00
found the time index!
going to restart using /scratch/PFM_Simulations/restart_data/LV2_ocean_rst_202507110000_202507160000.nc and python-index 0
PFM info was edited and resaved
...done setting up for restart.
this took:
0:00:00.877191

Going to use the file LV2_ocean_rst_202507110000_202507160000.nc to restart the simulation
with time index 1


making .in and .sb...
 --- making dot_in and dot_sb --- 
for this LV2 simulation
history file made will be:
/scratch/matt/PFM_Simulations_v2/LV2/His/LV2_ocean_his_202507110600.nc
restart file made will be:
/scratch/PFM_Simulations/restart_data/LV2_ocean_rst_202507110600_202507160600.nc
the ini file used is:
/scratch/PFM_Simulations/restart_data/LV2_ocean_rst_202507110000_202507160000.nc
we are using
/scratch/PFM_Simulations/executables/LV3_romsM_INTEL
...done
now running roms LV2 with slurm.
using 6 nodes.
Ni = 9, NJ = 24
working...
 --- running LV2 --- 
run_slurm_LV2: current directory is now:  /scratch/matt/PFM_Simulations_v2/LV2/Run
run_slurm_LV2: run command:  ['sbatch', '--wait', 'LV2_SLURM.sb']
subprocess slurm ran correctly? 0 (0=yes)
running ROMS took:
0:13:30.062161


...finished LV2 forecast.
return code: 0 (0=good)
done with LV2
LV2  forecast ran correctly? 0 (0=yes)
this took:
0:17:36.923552



--------------------------
starting LV3
starting LV3 forecast with subprocess...

we are now putting the fore atm data on the roms LV3 grid...
loading /scratch/matt/PFM_Simulations_v2/LV1/Forc/atm_tmp_pckl_file.pkl ...
interpolating to LV3 grid...
... done.
rotating velocities to LV 3 roms directions...
...done.
saving atm to LV3 pkl file...

ATM on roms grid dict saved with pickle.
return code: 0 (0=good)
...done.
this took:
0:00:03.124172


we are now saving ATM LV3 to /scratch/matt/PFM_Simulations_v2/LV3/Forc/LV3_ATM_FORCING.nc ...
return code: 0 (0=good)
...done.
this took:
0:00:01.206398


driver_run_forcast_LV3: saving LV3_OCN_BC pickle file
interpolating z with normal loops.
OCN_LV 3 _BC dict saved with pickle to:  /scratch/matt/PFM_Simulations_v2/LV3/Forc/BC_LV3_tmp_file.pkl
return code: 0 (0=good)
driver_run_forecast_LV3:  done with writing LV3_OCN_BC.pkl file.
this took:
0:04:15.837345


driver_run_forcast_LV3: saving LV3_OCN_BC netcdf file
OCN_BC dict loaded with pickle

max and min of data in ROMS BC file (iz is bottom [0] to top [39]):
max zeta_north =  1.099 m          at  ( it, ilon)     =  ( 23,  65)
min zeta_north = -0.964 m          at  ( it, ilon)     =  (  6, 233)
max zeta_south =  1.111 m          at  ( it, ilon)     =  ( 23,  17)
min zeta_south = -0.985 m          at  ( it, ilon)     =  (  6, 182)
max zeta_west  =  1.109 m          at  ( it, ilat)     =  ( 23,   8)
min zeta_west  = -0.946 m          at  ( it, ilat)     =  (  6, 332)
max ubar_north =  0.281 m/s        at  ( it, ilon)     =  ( 14, 248)
min ubar_north = -0.350 m/s        at  ( it, ilon)     =  ( 99, 248)
max ubar_south =  0.260 m/s        at  ( it, ilon)     =  ( 16, 191)
min ubar_south = -0.234 m/s        at  ( it, ilon)     =  ( 74, 248)
max ubar_west  =  0.070 m/s        at  ( it, ilat)     =  (  8, 209)
min ubar_west  = -0.066 m/s        at  ( it, ilat)     =  (  0,   0)
max vbar_north =  0.262 m/s        at  ( it, ilon)     =  (106, 246)
min vbar_north = -0.286 m/s        at  ( it, ilon)     =  ( 68, 248)
max vbar_south =  0.231 m/s        at  ( it, ilon)     =  (109, 167)
min vbar_south = -0.358 m/s        at  ( it, ilon)     =  ( 20, 189)
max vbar_west  =  0.049 m/s        at  ( it, ilat)     =  (110,   0)
min vbar_west  = -0.182 m/s        at  ( it, ilat)     =  ( 54, 360)
max u_north    =  0.480 m/s        at  ( it, iz, ilon) =  (110,  39, 189)
min u_north    = -0.662 m/s        at  ( it, iz, ilon) =  (101,  39, 114)
max u_south    =  0.558 m/s        at  ( it, iz, ilon) =  ( 80,   0, 159)
min u_south    = -0.560 m/s        at  ( it, iz, ilon) =  ( 11,   0, 160)
max u_west     =  0.422 m/s        at  ( it, iz, ilat) =  (109,  39, 113)
min u_west     = -0.490 m/s        at  ( it, iz, ilat) =  (  0,  38,  92)
max v_north    =  0.458 m/s        at  ( it, iz, ilon) =  (103,  39, 197)
min v_north    = -0.617 m/s        at  ( it, iz, ilon) =  (117,  39,  86)
max v_south    =  0.450 m/s        at  ( it, iz, ilon) =  (  7,   0, 133)
min v_south    = -0.543 m/s        at  ( it, iz, ilon) =  ( 21,  39, 137)
max v_west     =  0.402 m/s        at  ( it, iz, ilat) =  ( 81,  37, 411)
min v_west     = -0.567 m/s        at  ( it, iz, ilat) =  ( 91,  39, 222)
max temp_north = 22.863 C          at  ( it, iz, ilon) =  ( 41,  39, 241)
min temp_north =  4.197 C          at  ( it, iz, ilon) =  ( 20,   0,  30)
max temp_south = 22.643 C          at  ( it, iz, ilon) =  (117,  39, 106)
min temp_south =  3.233 C          at  ( it, iz, ilon) =  ( 25,   0,  40)
max temp_west  = 22.533 C          at  ( it, iz, ilat) =  (114,  39,  47)
min temp_west  =  3.165 C          at  ( it, iz, ilat) =  (  4,   0,  49)
max salt_north = 34.491 psu        at  ( it, iz, ilon) =  ( 21,   0,  29)
min salt_north = 33.466 psu        at  ( it, iz, ilon) =  (  0,  23,  29)
max salt_south = 34.540 psu        at  ( it, iz, ilon) =  ( 25,   0,  40)
min salt_south = 33.352 psu        at  ( it, iz, ilon) =  (107,  26,   0)
max salt_west  = 34.545 psu        at  ( it, iz, ilat) =  (  4,   0,  49)
min salt_west  = 33.352 psu        at  ( it, iz, ilat) =  (107,  26,   0)
return code: 0 (0=good)
driver_run_forecast_LV3:  done with writing LV2_OCN_BC.nc file.
this took:
0:00:01.067441


going to use a restart file for the LV3 IC. Setting this up...
going to restart LV3 from
2025-07-11 06:00:00
found the time index!
going to restart using /scratch/PFM_Simulations/restart_data/LV3_ocean_rst_202507110000_202507160000.nc and python-index 0
PFM info was edited and resaved
...done setting up for restart.
this took:
0:00:00.869157

Going to use the file LV3_ocean_rst_202507110000_202507160000.nc to restart the simulation
with time index 1


making .in and .sb...
for this LV3 simulation
history file made will be:
/scratch/matt/PFM_Simulations_v2/LV3/His/LV3_ocean_his_202507110600.nc
restart file made will be:
/scratch/PFM_Simulations/restart_data/LV3_ocean_rst_202507110600_202507160600.nc
the ini file used is:
/scratch/PFM_Simulations/restart_data/LV3_ocean_rst_202507110000_202507160000.nc
we are using
/scratch/PFM_Simulations/executables/LV3_romsM_INTEL
...done
now running roms LV3 with slurm.
using 10 nodes.
Ni = 12, NJ = 30
working...
 --- running LV3 --- 
run_slurm_LV3: current directory is now:  /scratch/matt/PFM_Simulations_v2/LV3/Run
run_slurm_LV3: run command:  ['sbatch', '--wait', 'LV3_SLURM.sb']
subprocess slurm ran correctly? 0 (0=yes)
running ROMS took:
0:17:46.074305


...finished LV3 forecast.
return code: 0 (0=good)
done with LV3
LV3  forecast ran correctly? 0 (0=yes)
this took:
0:22:09.092423



--------------------------
starting LV4
starting LV4 forecast with subprocess...

we are now putting the fore atm data on the roms LV4 grid...
loading /scratch/matt/PFM_Simulations_v2/LV1/Forc/atm_tmp_pckl_file.pkl ...
interpolating to LV4 grid...
... done.
rotating velocities to LV 4 roms directions...
...done.
saving atm to LV4 pkl file...

ATM on roms grid dict saved with pickle.
return code: 0 (0=good)
...done.
this took:
0:00:14.495792


we are now saving ATM LV4 to /scratch/matt/PFM_Simulations_v2/LV4/Forc/LV4_ATM_FORCING.nc ...
return code: 0 (0=good)
...done.
this took:
0:00:02.389284


driver_run_forcast_LV4: saving LV4_OCN_BC pickle file
interpolating z with normal loops.
OCN_LV 4 _BC dict saved with pickle to:  /scratch/matt/PFM_Simulations_v2/LV4/Forc/BC_LV4_tmp_file.pkl
return code: 0 (0=good)
driver_run_forecast_LV4:  done with writing LV4_OCN_BC.pkl file.
this took:
0:05:14.728911


driver_run_forcast_LV4: saving LV4_OCN_BC netcdf file
OCN_BC dict loaded with pickle

max and min of data in ROMS BC file (iz is bottom [0] to top [39]):
max zeta_north =  1.093 m          at  ( it, ilon)     =  ( 23,  28)
min zeta_north = -0.991 m          at  ( it, ilon)     =  (  6,  28)
max zeta_south =  1.085 m          at  ( it, ilon)     =  ( 23,  40)
min zeta_south = -0.994 m          at  ( it, ilon)     =  (  6, 361)
max zeta_west  =  1.092 m          at  ( it, ilat)     =  ( 23,1140)
min zeta_west  = -0.984 m          at  ( it, ilat)     =  (  6,1140)
max ubar_north =  0.374 m/s        at  ( it, ilon)     =  (111,  51)
min ubar_north = -0.094 m/s        at  ( it, ilon)     =  ( 95, 170)
max ubar_south =  0.231 m/s        at  ( it, ilon)     =  ( 40, 484)
min ubar_south = -0.115 m/s        at  ( it, ilon)     =  ( 76, 463)
max ubar_west  =  0.095 m/s        at  ( it, ilat)     =  ( 13,1016)
min ubar_west  = -0.111 m/s        at  ( it, ilat)     =  (100,1015)
max vbar_north =  0.382 m/s        at  ( it, ilon)     =  (109, 240)
min vbar_north = -0.270 m/s        at  ( it, ilon)     =  ( 92, 240)
max vbar_south =  0.213 m/s        at  ( it, ilon)     =  (108, 484)
min vbar_south = -0.308 m/s        at  ( it, ilon)     =  ( 19, 478)
max vbar_west  =  0.287 m/s        at  ( it, ilat)     =  (107,1072)
min vbar_west  = -0.154 m/s        at  ( it, ilat)     =  ( 27,1057)
max u_north    =  0.420 m/s        at  ( it, iz, ilon) =  (111,   0,  54)
min u_north    = -0.251 m/s        at  ( it, iz, ilon) =  ( 12,   1,   6)
max u_south    =  0.299 m/s        at  ( it, iz, ilon) =  ( 16,   9,  25)
min u_south    = -0.253 m/s        at  ( it, iz, ilon) =  ( 50,   9,   5)
max u_west     =  0.516 m/s        at  ( it, iz, ilat) =  (111,   9,1030)
min u_west     = -0.326 m/s        at  ( it, iz, ilat) =  (102,   0,1013)
max v_north    =  0.448 m/s        at  ( it, iz, ilon) =  (110,   9,  10)
min v_north    = -0.355 m/s        at  ( it, iz, ilon) =  ( 93,   9,   0)
max v_south    =  0.274 m/s        at  ( it, iz, ilon) =  (109,   9, 271)
min v_south    = -0.449 m/s        at  ( it, iz, ilon) =  ( 49,   9,   0)
max v_west     =  0.548 m/s        at  ( it, iz, ilat) =  (108,   9,1097)
min v_west     = -0.449 m/s        at  ( it, iz, ilat) =  ( 49,   9,   0)
max temp_north = 22.192 C          at  ( it, iz, ilon) =  ( 39,   0,  32)
min temp_north = 12.865 C          at  ( it, iz, ilon) =  ( 10,   0,   0)
max temp_south = 22.458 C          at  ( it, iz, ilon) =  ( 41,   0, 384)
min temp_south = 12.767 C          at  ( it, iz, ilon) =  (100,   0,   6)
max temp_west  = 22.669 C          at  ( it, iz, ilat) =  (114,   9, 261)
min temp_west  = 10.751 C          at  ( it, iz, ilat) =  (102,   0,1030)
max salt_north = 33.623 psu        at  ( it, iz, ilon) =  ( 41,   9,   0)
min salt_north = 33.546 psu        at  ( it, iz, ilon) =  ( 78,   4,   0)
max salt_south = 33.633 psu        at  ( it, iz, ilon) =  (119,   9,   8)
min salt_south = 33.423 psu        at  ( it, iz, ilon) =  ( 95,   4,   4)
max salt_west  = 33.696 psu        at  ( it, iz, ilat) =  (102,   0,1030)
min salt_west  = 33.408 psu        at  ( it, iz, ilat) =  ( 70,   4, 232)
return code: 0 (0=good)
driver_run_forecast_LV4:  done with writing LV4_OCN_BC.nc file.
this took:
0:00:01.010602


going to use a restart file for the LV4 IC. Setting this up...
going to restart LV4 from
2025-07-11 06:00:00
found the time index!
going to restart using /scratch/PFM_Simulations/restart_data/LV4_ocean_rst_202507110000_202507160000.nc and python-index 0
going to deleting swan base rst files...
deleting some files...
removing swan restart files older than now - 7.0 days old...
there were no swan restart files older than now minus 7.0 days old
there was not a previous forecast with this forecast time. No swan restart files were deleted.
going to restart swan, forecast start time is
2025-07-11 06:00:00
we are going to restart swan with the line ...
HOTSTART '/scratch/PFM_Simulations/restart_data/LV4_swan_rst_202507110000_006.dat'
PFM info was edited and resaved
...done setting up for restart.
this took:
0:00:01.382632

Going to use the file LV4_ocean_rst_202507110000_202507160000.nc to restart the simulation
with time index 1


driver_run_forcast_LV4: making clm.nc, nud.nc, and river.nc files...
OCN_BC dict loaded with pickle
clm return code: 0 (0=good)
nud return code: 0 (0=good)
making river tracer dictionary
making the river discharge pickle file
using the nwm river forecast from the start time:
2025071100
to ensure that the forecast can be found on their server

river discharge data saved as pickle file
loading the river discharge pickle file...
the time-mean discharge for TJR is 
-0.7319512031518103 m3/s
or  -16.706054260736916 MGD
the time-mean discharge for Sweetwater is 
-1.998373939072698 m3/s
or  -45.610886785395266 MGD
the time-mean discharge for Otay Mesa is 
-0.901300792862487 m3/s
or  -20.571289296293404 MGD
the time-constant discharge for Punta Bandera is 
-2.0 m3/s
or  -45.648 MGD
getting the river temperature. For each river, each time, and depth,
      it is the mean air temp over the LV4 land domain...
the time-mean river dye for Punta Bandera is 
0.5
the time-mean river dye for TJRE is 
0.6500000000000002
the time-mean river temp for all rivers is 
18.84753644268323
river return code: 0 (0=good)
driver_run_forecast_L4:  done making clm, nud, and river.nc files.
this took:
0:04:07.868649


driver_run_forcast_LV4: making swan bnd and wnd files...
removing previous cdip .nc files...
...done. getting new cdip .nc files...
...done. making dictionary of cdip data...
...done.

CDIP data saved as pickle file
cdip to dictionary return code: 0 (0=good)
making swan .bnd file...

CDIP pickle file loaded
...done. swan bnd file return code: 0 (0=good)
making swan wnd file...
...done. swan wnd file return code: 0 (0=good)
...done. making swan .bnd and .wnd files took:
0:04:37.005744
making LV4 ocean, swan, coupling .in and .sb...
we are using
/scratch/PFM_Simulations/executables/coawstM_intel
for LV4
...done
now running Coawst LV4 with slurm.
using 14 nodes (= 504 CPUs.)
using 432 CPUs for ROMS, with tiling:
Ni = 12, NJ = 36
and using 72 CPUs for SWAN.
working...
starting the background process that looks for modified swan restart files
we check for modified files every 144 s (wall time)
run_slurm_LV4: current directory is now:  /scratch/matt/PFM_Simulations_v2/LV4/Run
terminated the swan restart file check and move subprocess.
CompletedProcess(args=['sbatch', '--wait', 'LV4_SLURM.sb'], returncode=0, stdout=b'Submitted batch job 2404\n', stderr=b'')
run_slurm_LV4: run command:  ['sbatch', '--wait', 'LV4_SLURM.sb']
subprocess slurm ran correctly? 0 (0=yes)
...done.
this took:
3:40:42.681432


now making LV4 history file plots...
getting clims...
...done.
...done plotting LV4: 0 (0=good)
this took:
0:02:47.938153
now making LV4 dye plots...
...done plotting LV4: 0 (0=good)
this took:
0:03:03.186226

moving LV4 atm and river files to Archive...
...done
making the web netcdf file...
...done making web nc file: 0 (0=good)
this took:
0:00:15.409582
OCN_LV4 timing info dict saved with pickle to:  /scratch/matt/PFM_Simulations_v2/LV4/Run/LV4_timing_info.pkl
...finished LV4 forecast.
return code: 0 (0=good)
done with LV4
LV4  forecast ran correctly? 0 (0=yes)
this took:
3:58:24.811442



!Finished the forecast subprocess!

return code: 0  (0=good)
